"use strict";(self["webpackChunkjpgupup"]=self["webpackChunkjpgupup"]||[]).push([[78],{1078:(t,e,o)=>{o.r(e),o.d(e,{default:()=>Ot});var i=o(3673);function s(t,e,o,s,n,a){const l=(0,i.up)("TipsContent"),r=(0,i.up)("q-page");return(0,i.wg)(),(0,i.j4)(r,{class:"row justify-evenly"},{default:(0,i.w5)((()=>[(0,i.Wm)(l)])),_:1})}var n=o(2323),a=o(8880);const l=t=>((0,i.dD)("data-v-03c8d658"),t=t(),(0,i.Cn)(),t),r={class:"tipsDiv mainWidth"},c={class:"tipsDiv"},d=["textContent"],m={class:"BtnDiv"},h=l((()=>(0,i._)("span",{class:"text-grey-8",style:{"margin-top":"6px","font-weight":"600"}},"按Ctrl+V粘贴图像或拖放图片",-1))),u={class:"ImageViewDiv"},g={class:"pos-relative"},p={class:"progressText"},f=l((()=>(0,i._)("span",{class:"q-ml-sm"},"重新识别图片将终止当前图片的识别",-1)));function I(t,e,o,s,l,I){const w=(0,i.up)("q-btn"),v=(0,i.up)("ImageViewer"),y=(0,i.up)("q-circular-progress"),T=(0,i.up)("q-inner-loading"),D=(0,i.up)("ControlBar"),S=(0,i.up)("UploadImage"),b=(0,i.up)("q-avatar"),_=(0,i.up)("q-card-section"),C=(0,i.up)("q-card-actions"),M=(0,i.up)("q-card"),z=(0,i.up)("q-dialog"),P=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",r,[(0,i._)("div",{class:(0,n.C_)({MinTipsAndBtn:t.srcImg})},[(0,i._)("div",c,[(0,i._)("h3",{class:(0,n.C_)(["text-grey-10",{MTitlefontSizeMin:t.srcImg,MainTitle:!t.srcImg}])}," 使用AI技术放大图像 ",2),(0,i._)("h5",{class:(0,n.C_)(["Subtitle text-grey-8",{STitlefontSizeMin:t.srcImg}]),textContent:(0,n.zw)(!t.srcImg||t.dstImg?"智能算法，无数据上传，完全的隐私保护":"使用高精度算法运算中，耗时较长，请耐心等待")},null,10,d)]),(0,i._)("div",m,[(0,i.Wm)(w,{size:t.srcImg?"20px":"32px",class:(0,n.C_)({"btn-fixed-width":!t.srcImg}),disable:100!=t.modelDownPresent,color:100==t.modelDownPresent?"light-blue":"grey",label:t.buttonTitle,onClick:t.onUploadImageClick},null,8,["size","class","disable","color","label","onClick"]),h])],2),(0,i.wy)((0,i._)("div",u,[(0,i._)("div",g,[(0,i.Wm)(v,{leftImg:t.dstImg,rightImg:t.srcImg,showModel:t.ctrlInfo.showModel,syncTranform:t.ctrlInfo.syncZoom,onScaleChanged:e[0]||(e[0]=e=>{t.ctrlInfo.scaleVal=e})},null,8,["leftImg","rightImg","showModel","syncTranform"]),(0,i.Wm)(T,{showing:t.loadingShow},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{value:t.progressVal,size:"100px",class:"q-ma-md"},null,8,["value"]),(0,i._)("span",p,(0,n.zw)("正在放大"+(t.eta>0?"，预计还需"+t.eta+"秒":"")),1)])),_:1},8,["showing"])]),t.dstImg?((0,i.wg)(),(0,i.j4)(D,{key:0,modelValue:t.ctrlInfo,"onUpdate:modelValue":e[1]||(e[1]=e=>t.ctrlInfo=e)},null,8,["modelValue"])):(0,i.kq)("",!0)],512),[[a.F8,t.srcImg]])]),(0,i.Wm)(S,{ref:"uploader",onImageReceived:t.onImageReceived},null,8,["onImageReceived"]),(0,i.Wm)(z,{modelValue:t.replaceConfirm,"onUpdate:modelValue":e[2]||(e[2]=e=>t.replaceConfirm=e),persistent:""},{default:(0,i.w5)((()=>[(0,i.Wm)(M,null,{default:(0,i.w5)((()=>[(0,i.Wm)(_,{class:"row items-center"},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{icon:"error_outline",color:"primary","text-color":"white"}),f])),_:1}),(0,i.Wm)(C,{align:"right"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(w,{flat:"",label:"取消",color:"primary"},null,512),[[P]]),(0,i.wy)((0,i.Wm)(w,{flat:"",label:"确认",color:"primary",onClick:t.onReplaceConfirmOk},null,8,["onClick"]),[[P]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}function w(t,e,o,s,n,a){return(0,i.wg)(),(0,i.iD)("input",{ref:"inputFile",type:"file",style:{display:"none"},onChange:e[0]||(e[0]=e=>t.addImgPreview()),accept:"image/*"},null,544)}const v=(0,i.aZ)({data(){return{RecoDataList:[]}},emits:{ImageReceived(t,e){return t.length>0&&e.length>0}},mounted(){window.addEventListener("paste",(t=>{let e=t;if(e.clipboardData)for(const o of e.clipboardData.items){if(0!=o.type.indexOf("image"))continue;let t=o.getAsFile(),i=URL.createObjectURL(t);this.$emit("ImageReceived",i,"clipboard.png"),e.preventDefault(),e.stopPropagation()}}))},methods:{trigUpload(){let t=this.$refs.inputFile;t.dispatchEvent(new MouseEvent("click"))},addImgPreview(t){let e=this.$refs.inputFile;const o=this.$emit;if(t||(t=e.files),t){for(const e of t){if(!e)return void console.log("error");{if("image"!==e.type.substring(0,5))return;const t=new FileReader;t.readAsDataURL(e),t.onload=function(){o("ImageReceived",this.result,e.name)}}}e.value=""}}}});var y=o(4260);const T=(0,y.Z)(v,[["render",w]]),D=T,S={ref:"mainDiv",class:"overflow-hidden mainDiv"},b=["src"],_=["src"];function C(t,e,o,s,a,l){const r=(0,i.up)("q-avatar"),c=(0,i.up)("q-splitter"),d=(0,i.up)("q-resize-observer");return(0,i.wg)(),(0,i.iD)("div",S,[(0,i.Wm)(c,{id:"photos",modelValue:t.splitterModel,"onUpdate:modelValue":e[0]||(e[0]=e=>t.splitterModel=e),limits:[0,100],style:(0,n.j5)(t.splitterSizeStyle),"before-class":"overflow-hidden","after-class":"overflow-hidden","separator-class":{unvisable:!t.leftImg||!t.rightImg,splitter_touch:!t.compareModel&&t.$q.platform.has.touch,splitter_notouch:!t.compareModel&&!t.$q.platform.has.touch,splitter_fix:t.compareModel,"bg-blue-grey-7":!0}},{before:(0,i.w5)((()=>[(0,i._)("div",{class:"absolute-top-left",style:(0,n.j5)(t.splitterSizeStyle)},[(0,i._)("img",{id:"EnlargeImg",ref:"leftImg",src:t.leftImg},null,8,b)],4)])),separator:(0,i.w5)((()=>[(0,i.Wm)(r,{"text-color":"grey-1",size:t.$q.platform.has.touch?"64px":"46px",icon:t.compareModel?"":"more_vert"},null,8,["size","icon"])])),after:(0,i.w5)((()=>[(0,i._)("div",{class:(0,n.C_)({"absolute-top-right":!t.compareModel}),style:(0,n.j5)(t.splitterSizeStyle)},[(0,i._)("img",{ref:"rightImg",src:t.rightImg,class:"absolute-top-left"},null,8,_)],6)])),_:1},8,["modelValue","style","separator-class"]),(0,i.Wm)(d,{onResize:t.onResize},null,8,["onResize"])],512)}var M;(function(t){t["LImg"]="LImg",t["RImg"]="RImg",t["Compare"]="Compare"})(M||(M={}));let z={lastId:0},P=!1;function V(t){let e=t.getAttribute("ImgHandleDataID");if(void 0==e){let o={ele:t,translate:[0,0],scale:1,maxScaleVal:10,minScaleVal:128/Math.max(t.offsetWidth,t.offsetHeight),zoomOrigin:[0,0],lastTouchTime:0,applyTransform(t,e){void 0!=t&&(this.translate[0]=t[0],this.translate[1]=t[1]),void 0!=e&&(this.scale=e),this.onTransform&&void 0===e&&void 0===t&&this.onTransform(this.translate,this.scale),this.ele.style.transform="translate("+this.translate[0].toString()+"px, "+this.translate[1].toString()+"px)scale("+this.scale.toString()+")"},move(t,e){t+=this.translate[0],e+=this.translate[1];let o=this.ele.parentNode,i=o.offsetWidth,s=o.offsetHeight,n=this.ele.offsetWidth*this.scale,a=this.ele.offsetHeight*this.scale,l=Math.max(i/2,i-n),r=Math.min(i/2-n,0);t>l&&(t=l),t<r&&(t=r),l=Math.max(s/2,s-a),r=Math.min(s/2-a,0),e>l&&(e=l),e<r&&(e=r),this.translate[0]=t,this.translate[1]=e},setPos(t,e){this.translate[0]=t,this.translate[1]=e},zoom(t){let e=this.zoomOrigin[0]*this.scale,o=this.zoomOrigin[1]*this.scale,i=this.scale*t;this.scale<1&&i>1||this.scale>1&&i<1?this.scale=1:this.scale=i,this.scale>this.maxScaleVal?this.scale=this.maxScaleVal:this.scale<this.minScaleVal&&(this.scale=this.minScaleVal);let s=this.zoomOrigin[0]*this.scale,n=this.zoomOrigin[1]*this.scale;this.move(e-s,o-n)},setZoomOrigin(t,e){this.zoomOrigin[0]=(t-this.translate[0])/this.scale,this.zoomOrigin[1]=(e-this.translate[1])/this.scale},fillToParent(){let t=this.ele.parentNode;const e=5,o=5;let i=t.offsetWidth,s=t.offsetHeight,n=this.ele.offsetWidth,a=this.ele.offsetHeight;this.minScaleVal=128/Math.max(n,a);let l=Math.min((s-2*e)/a,(i-2*o)/n);l>1&&(l=1),this.scale=l,n*=l,a*=l;let r=(i-n)/2,c=(s-a)/2;this.setPos(r,c)}};e=z.lastId.toString(),z.lastId++,z[e]=o,t.setAttribute("ImgHandleDataID",e)}return z[e]}function k(t,e){let o=Math.sqrt(Math.pow(t.pageX-e.pageX,2)+Math.pow(t.pageX-e.pageX,2));return o}function x(t){t.preventDefault();let e=V(this);t||window.event;if(e.isMoved=!1,t.touches.length>=2)clearTimeout(e.OneTouchTimer),e.multPointStart=t.touches,e.setZoomOrigin(t.touches[0].pageX+(t.touches[1].pageX-t.touches[0].pageX)/2,t.touches[0].pageY+(t.touches[1].pageY-t.touches[0].pageY)/2),console.log("多点触摸事件");else{let o=Date.now()-e.lastTouchTime;e.lastTouchTime=Date.now(),e.startPosition=[t.touches[0].pageX,t.touches[0].pageY],o>0&&o<=250?(console.log("zoom",t.touches[0]),e.setZoomOrigin(t.touches[0].pageX,t.touches[0].pageY-this.offsetTop),clearTimeout(e.OneTouchTimer),e.isDoubleTouch=!0):(e.OneTouchTimer=setTimeout((function(){console.log("单击事件",e,t),e.onTap&&e.onTap(t)}),350),e.isDoubleTouch=!1)}}function R(t){t.preventDefault();let e=V(this);e.isMoved=!0,clearTimeout(e.OneTouchTimer),t.touches.length>=2?(console.log("e.touches.length >= 2"),U(e,t)):e.isDoubleTouch?$(e,t):O(e,t)}function Z(t){t.preventDefault();let e=V(this);1==t.touches.length&&(e.startPosition=[t.touches[0].pageX,t.touches[0].pageY]),e.isMoved||e.isDoubleTouch&&B(e)}function W(t){if("SPAN"==t.target.tagName)return void(P=!1);t.preventDefault();let e=V(this);e.fillToParent(),e.applyTransform()}function q(t){t.preventDefault();let e=V(this);e.setZoomOrigin(t.layerX,t.layerY);const o=t.deltaY>0?.8:1.2;e.zoom(o),e.applyTransform()}function L(t){if(1==t.button)return;if("SPAN"==t.target.tagName)return void(P=!1);t.preventDefault(),P=!0;let e=V(this);e.startPosition=[t.layerX,t.layerY]}function E(t){if(1==t.button){let t=V(this);return t.fillToParent(),void t.applyTransform()}}function B(t){t.fillToParent(),t.applyTransform()}function U(t,e){let o=e.touches,i=k(o[0],o[1])/k(t.multPointStart[0],t.multPointStart[1]);t.zoom(i),t.multPointStart=e.touches,t.applyTransform()}function $(t,e){let o=1+(t.startPosition[1]-e.touches[0].pageY)/150;t.zoom(o),t.applyTransform(),t.startPosition=[e.touches[0].pageX,e.touches[0].pageY]}function O(t,e){let o=[e.touches[0].pageX,e.touches[0].pageY],i=[o[0]-t.startPosition[0],o[1]-t.startPosition[1]];t.startPosition=o,t.move(i[0],i[1]),t.applyTransform()}function Q(t){if(!P||1!=t.buttons)return;t.preventDefault();let e=V(this),o=[t.layerX,t.layerY],i=[o[0]-e.startPosition[0],o[1]-e.startPosition[1]];e.startPosition=o,e.move(i[0],i[1]),e.applyTransform()}function H(t){let e=t.getAttribute("ImgHandleDataID");e&&delete z[e]}function A(t){let e=t.getAttribute("ImgHandleDataID");void 0==e?(t.addEventListener("touchstart",x,!1),t.addEventListener("touchmove",R,!1),t.addEventListener("touchend",Z,!1),t.addEventListener("mousewheel",q,!1),t.addEventListener("dblclick",W,!1),t.addEventListener("mousedown",L,!1),t.addEventListener("mouseup",E,!1),t.addEventListener("mousemove",Q,!1),t.style.transformOrigin="0 0"):H(t),t.removeAttribute("ImgHandleDataID");let o=V(t);return o.fillToParent(),o.applyTransform(),o}function X(t){let e=t.fillToParent?t:V(t);e.fillToParent(),e.applyTransform()}let j=(0,i.aZ)({data(){return{width:"100%",height:"60vh",splitterModel:0,scaleVal:[0,0],syncTranformVal:!1,translate:[0,0],imageHandleL:void 0,imageHandleR:void 0,compareModel:!0}},emits:{scaleChanged(t){return t[0]>=0}},props:{leftImg:{type:String,default(){return"https://cdn.quasar.dev/img/parallax1.jpg"}},rightImg:{type:String,default(){return"https://cdn.quasar.dev/img/parallax1-bw.jpg"}},showModel:{type:String,default(){return M.LImg}},syncTranform:{type:Boolean,default(){return!1},required:!0}},mounted(){this.onResize();const t=A(this.$refs.leftImg),e=A(this.$refs.rightImg);this.imageHandleL=t,this.imageHandleR=e,t.onTransform=(t,o)=>{""===this.leftImg||o<=0||(this.scaleVal[0]=o,this.syncTranformVal&&(this.scaleVal[1]=4*o,e.applyTransform(t,this.scaleVal[1])),this.$emit("scaleChanged",this.scaleVal))},e.onTransform=(e,o)=>{""===this.rightImg||o<=0||(this.scaleVal[1]=o,this.syncTranformVal&&(this.scaleVal[0]=o/4,t.applyTransform(e,this.scaleVal[0])),this.$emit("scaleChanged",this.scaleVal))},this.$refs.leftImg.onload=()=>{console.log("fillToParent",this.$refs.leftImg.width),X(this.$refs.leftImg)},this.$refs.rightImg.onload=()=>{console.log("fillToParent",this.$refs.rightImg.width),X(this.$refs.rightImg)}},methods:{onResize(){const t=this.$refs.mainDiv;this.width=t.offsetWidth.toString()+"px"}},watch:{syncTranform(t){var e,o;this.syncTranformVal=t,this.syncTranformVal&&(null===(e=this.imageHandleR)||void 0===e||e.applyTransform(null===(o=this.imageHandleL)||void 0===o?void 0:o.translate,4*this.scaleVal[0]))},showModel(t){console.log("showModel change"),t==M.LImg?(this.splitterModel=100,this.compareModel=!1):t==M.RImg?(this.splitterModel=0,this.compareModel=!1):t==M.Compare&&(this.compareModel=!0,this.splitterModel=50),this.$nextTick().then((()=>{this.rightImg&&X(this.$refs.rightImg),this.leftImg&&X(this.$refs.leftImg)})).catch(void 0)},rightImg(){this.rightImg&&X(this.$refs.rightImg)},leftImg(){this.leftImg&&X(this.$refs.leftImg)}},computed:{splitterSizeStyle(){let t={height:this.height,width:this.compareModel?"100%":this.width};return t}}});const Y=j;var F=o(6595),N=o(5096),G=o(5151),J=o(7518),K=o.n(J);const tt=(0,y.Z)(Y,[["render",C],["__scopeId","data-v-e16eb54a"]]),et=tt;K()(Y,"components",{QSplitter:F.Z,QAvatar:N.Z,QResizeObserver:G.Z});const ot={class:"MinTipsAndBtn"},it={class:"BtnDiv"},st={class:"LabelDiv"},nt={class:"BtnDiv"};function at(t,e,o,s,a,l){const r=(0,i.up)("q-btn"),c=(0,i.up)("q-btn-group"),d=(0,i.up)("q-toggle"),m=(0,i.up)("q-item-label"),h=(0,i.up)("q-item-section"),u=(0,i.up)("q-item"),g=(0,i.up)("q-list"),p=(0,i.up)("q-btn-dropdown"),f=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.iD)("div",ot,[(0,i._)("div",it,[(0,i.Wm)(c,{outline:""},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{outline:"",label:"放大图",icon:"arrow_back_ios",onClick:e[0]||(e[0]=e=>{t.ctrlInfo.showModel="LImg",t.emitProp()})}),(0,i.Wm)(r,{outline:"",label:"对比",onClick:e[1]||(e[1]=e=>{t.ctrlInfo.showModel="Compare",t.emitProp()})}),(0,i.Wm)(r,{outline:"",label:"原图","icon-right":"arrow_forward_ios",onClick:e[2]||(e[2]=()=>{t.ctrlInfo.showModel="RImg",t.emitProp()})})])),_:1}),(0,i.Wm)(d,{modelValue:t.ctrlInfo.syncZoom,"onUpdate:modelValue":e[3]||(e[3]=e=>t.ctrlInfo.syncZoom=e),"checked-icon":"check",label:"同步缩放","unchecked-icon":"clear",onInput:t.emitProp},null,8,["modelValue","onInput"])]),(0,i._)("div",st,[(0,i._)("span",null,"放大图像: "+(0,n.zw)(t.ctrlInfo.dstImgSize[0]+" x "+t.ctrlInfo.dstImgSize[1]+"("+Math.round(100*t.ctrlInfo.scaleVal[0])+"%)"),1),(0,i._)("span",null,"原始图像:"+(0,n.zw)(t.ctrlInfo.dstImgSize[0]/4+" x "+t.ctrlInfo.dstImgSize[1]/4+"("+Math.round(100*t.ctrlInfo.scaleVal[1])+"%)"),1)]),(0,i._)("div",nt,[(0,i.Wm)(p,{split:"",class:"glossy",size:"22px",color:"light-blue",label:"下载放大图片",onClick:t.downImg},{default:(0,i.w5)((()=>[(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.wy)(((0,i.wg)(),(0,i.j4)(u,{clickable:"",onClick:e[4]||(e[4]=e=>t.downImgBySize(Math.round(t.ctrlInfo.scaleVal[0]*t.ctrlInfo.dstImgSize[0]),Math.round(t.ctrlInfo.scaleVal[0]*t.ctrlInfo.dstImgSize[1])))},{default:(0,i.w5)((()=>[(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Uk)("预览尺寸 ["+(0,n.zw)(Math.round(t.ctrlInfo.scaleVal[0]*t.ctrlInfo.dstImgSize[0])+" x "+Math.round(t.ctrlInfo.scaleVal[0]*t.ctrlInfo.dstImgSize[1]))+"]",1)])),_:1})])),_:1})])),_:1})),[[f]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(u,{clickable:"",onClick:e[5]||(e[5]=e=>t.downImgBySize(.5*t.ctrlInfo.dstImgSize[0],.5*t.ctrlInfo.dstImgSize[1]))},{default:(0,i.w5)((()=>[(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Uk)("2X尺寸 ["+(0,n.zw)(.5*t.ctrlInfo.dstImgSize[0]+" x "+.5*t.ctrlInfo.dstImgSize[1])+"]",1)])),_:1})])),_:1})])),_:1})),[[f]])])),_:1})])),_:1},8,["onClick"])])])}const lt=(0,i.aZ)({name:"CompositionComponent",data(){return{ctrlInfo:this.modelValue}},props:{modelValue:{type:Object,required:!0}},methods:{emitProp(){this.$emit("update:modelValue",this.ctrlInfo)},downImg(t){const e=document.getElementById("EnlargeImg"),o=document.createElement("a");if(o.href="string"===typeof t?t:e.src,o.setAttribute("download",this.ctrlInfo.fileName),console.log(t,o.href),document.createEvent){const t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),o.dispatchEvent(t)}else o.click()},downImgBySize(t,e){const o=document.getElementById("EnlargeImg"),i=document.createElement("canvas"),s=i.getContext("2d");i.width=Math.round(t),i.height=Math.round(e),null===s||void 0===s||s.drawImage(o,0,0,o.width,o.height,0,0,i.width,i.height);const n=i.toDataURL("image/png");this.downImg(n)}}});var rt=o(6375),ct=o(6819),dt=o(8886),mt=o(9788),ht=o(7011),ut=o(3414),gt=o(2035),pt=o(2350),ft=o(677);const It=(0,y.Z)(lt,[["render",at],["__scopeId","data-v-81f18a06"]]),wt=It;K()(lt,"components",{QBtnGroup:rt.Z,QBtn:ct.Z,QToggle:dt.Z,QBtnDropdown:mt.Z,QList:ht.Z,QItem:ut.Z,QItemSection:gt.Z,QItemLabel:pt.Z}),K()(lt,"directives",{ClosePopup:ft.Z});o(6101),o(979),o(6105),o(5123),o(2396);o.p;function vt(){return new Worker(o.p+"js/AntRealSRWorker.4f876518.worker.js")}const yt=o.p+"ab69640307fc952cac6e0cf5fd205a41.tf";var Tt={};console.log("ModelDown init"),Tt.calcProgress=function(){let t=Tt.totalSize,e=Tt.loadedSize;Tt.onprogress&&Tt.onprogress(e,t)},Tt.downData=function(){Tt.url=yt,Tt.xhrarr?Tt.xhrarr.abort():Tt.xhrarr=new XMLHttpRequest,Tt.totalSize=33442522,Tt.loadedSize=0;let t=Tt.xhrarr;t.open("GET",Tt.url),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.responseType="arraybuffer",t.onprogress=function(t){t.lengthComputable&&(Tt.totalSize=t.total,Tt.loadedSize=t.loaded,Tt.calcProgress())},t.onload=function(t){4===this.readyState&&200===this.status&&Tt.onfinish&&Tt.onfinish(this.response)},t.send(null)};const Dt=Tt;let St=document.createElement("canvas"),bt=St.getContext("2d");function _t(t,e){St.width=t,St.height=e}let Ct={isBusy:!1,predict:function(t){_t(t.width,t.height),bt.drawImage(t,0,0);var e=bt.getImageData(0,0,t.width,t.height);let o=new ArrayBuffer(e.data.length);var i=new Uint8Array(o);for(let s=0;s<i.length;s++)i[s]=e.data[s];Ct.worker.postMessage({cmd:"predict",width:t.width,height:t.height,data:o,params:Ct.params},[o])},predict_Url:function(t,e){Ct.isBusy&&Ct.stop(),Ct.worker?Ct.__predict_Url(t,e):Ct.init().then((function(){Ct.__predict_Url(t,e)}))},__predict_Url:function(t,e){var o=new Image;Ct.isBusy?Ct["onError"]&&Ct["onError"]("antocr is busy"):(Ct.isBusy=!0,o.userData=e,o.onload=function(){Ct.onImageLoad&&Ct.onImageLoad(this,this.userData),Ct.predict(this)},o.src=t)},onmessage:function(t){if("Init"==t.data)return Ct.onRuntimeInitialized&&Ct.onRuntimeInitialized(),Ct.isInit||(Ct.isInit=!0),Ct.params||(Dt.onprogress=Ct.onModelDownProgress,Dt.onfinish=function(t){Ct.params=t,Ct.onDataFinish&&Ct.onDataFinish()},Dt.downData()),Ct.isInit=!0,void Ct.initPromise[0]();if("predictFinish"==t.data.cmd){let e=t.data.width,o=t.data.height,i=new Uint8Array(t.data.data);_t(e,o);let s=bt.createImageData(e,o);s.data.set(i),bt.putImageData(s,0,0);let n={width:e,height:o,url:St.toDataURL("image/png")};console.log(n),Ct["onCompleted"]&&Ct["onCompleted"](n),Ct.isBusy=!1,Ct.worker.terminate(),Ct.worker=void 0}"progressCB"==t.data.cmd&&Ct["onProgress"]&&Ct["onProgress"](t.data.val,t.data.maxVal)},stop:function(){Ct.worker&&(Ct.worker.terminate(),Ct.worker=void 0,Ct.isBusy=!1,Ct["onProgress"]&&Ct["onProgress"](0,1))},init:function(){return Ct.stop(),Ct.worker=new vt,Ct.worker.onmessage=Ct.onmessage,new Promise((function(t,e){Ct.initPromise=[t,e]}))}};Ct.init();const Mt=Ct;let zt=Mt;const Pt=(0,i.aZ)({name:"CompositionComponent",data(){return{dstImg:"",srcImg:"",loadingShow:!1,modelDownPresent:0,progressVal:0,notification:!1,replaceConfirm:!1,replaceConfirmThen:()=>{},eta:-1,startTime:0,ctrlInfo:{dstImgSize:[0,0],syncZoom:!1,showModel:M.RImg,scaleVal:[0,0],fileName:""}}},components:{UploadImage:D,ImageViewer:et,ControlBar:wt},computed:{buttonTitle(){let t=this.modelDownPresent.toString();return this.srcImg?"重新选择图片":100!=this.modelDownPresent?"正在加载"+t+"%":"选择图片文件"}},mounted(){zt.onModelDownProgress=(t,e)=>{this.modelDownPresent=Math.round(t/e*100)},zt.onDataFinish=()=>{this.modelDownPresent=100},zt.onProgress=(t,e)=>{this.onProcess(t,e)},zt.onRuntimeInitialized=()=>{console.log("onRuntimeInitialized")}},methods:{onReplaceConfirmOk(){this.replaceConfirmThen()},onUploadImageClick(){let t=this.$refs.uploader;t.trigUpload()},onEnlargeFinish(t){this.dstImg=t,this.ctrlInfo.showModel=M.LImg,document.hidden&&"true"===localStorage.getItem("notification")&&new Notification("JpuUpUp",{body:"图像放大运算完成!",icon:this.srcImg}),this.eta=-1,this.progressVal=0},onProcess(t,e){1==t&&(this.startTime=(new Date).getTime());const o=Math.round(t/e*100);if(this.progressVal!==o&&(this.progressVal=o,t>10)){const o=(new Date).getTime();this.eta=(o-this.startTime)/t*(e-t),this.eta=Math.round(this.eta/1e3)}},onImageReceived(t,e,o=!1){if(0==o&&zt.isBusy)return this.replaceConfirmThen=()=>{this.onImageReceived(t,e,!0)},void(this.replaceConfirm=!0);100==this.modelDownPresent&&(this.srcImg=t,this.dstImg="",this.ctrlInfo.showModel=M.RImg,this.ctrlInfo.fileName=e,zt.onCompleted=t=>{this.loadingShow=!1,this.ctrlInfo.dstImgSize=[t.width,t.height],this.onEnlargeFinish(t.url)},zt.predict_Url(t),this.loadingShow=!0,console.log(e))}}});var Vt=o(6941),kt=o(7086),xt=o(5926),Rt=o(151),Zt=o(5589),Wt=o(9367);const qt=(0,y.Z)(Pt,[["render",I],["__scopeId","data-v-03c8d658"]]),Lt=qt;K()(Pt,"components",{QBtn:ct.Z,QInnerLoading:Vt.Z,QCircularProgress:kt.Z,QDialog:xt.Z,QCard:Rt.Z,QCardSection:Zt.Z,QAvatar:N.Z,QCardActions:Wt.Z}),K()(Pt,"directives",{ClosePopup:ft.Z});var Et=o(1959);const Bt=(0,i.aZ)({name:"PageIndex",components:{TipsContent:Lt},setup(){const t=(0,Et.iH)([{id:1,content:"ct1"},{id:2,content:"ct2"},{id:3,content:"ct3"},{id:4,content:"ct4"},{id:5,content:"ct5"}]),e=(0,Et.iH)({totalCount:1200});return{todos:t,meta:e}}});var Ut=o(4379);const $t=(0,y.Z)(Bt,[["render",s]]),Ot=$t;K()(Bt,"components",{QPage:Ut.Z})}}]);